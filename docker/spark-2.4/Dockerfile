ARG POLYNOTE_VERSION="0.3.12-2.12" 
ARG SCALA_VERSION="2.12"
FROM polynote/polynote:0.3.12-2.12
# FROM polynote/polynote:${POLYNOTE_VERSION}-${SCALA_VERSION}

ARG HADOOP_BASE_VERSION="3.2"
ARG HADOOP_VERSION="3.2.2"
ARG SPARK_HADOOP_VERSION="hadoop${HADOOP_BASE_VERSION}"
ARG SPARK_VERSION="3.0.1"
ARG SPARK_VERSION_DIR="spark-${SPARK_VERSION}"
ARG HADOOP_VERSION_DIR="hadoop-${HADOOP_VERSION}"

WORKDIR /opt

USER root

COPY install_spark.sh .
RUN ./install_spark.sh && rm ./install_spark.sh
ENV SPARK_HOME="/opt/spark"
ENV HADOOP_HOME="/opt/${HADOOP_VERSION_DIR}"
ENV PATH="$PATH:$SPARK_HOME/bin:$SPARK_HOME/sbin"

# switch to non-root user
USER ${NB_USER}